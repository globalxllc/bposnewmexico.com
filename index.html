<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BPOs New Mexico</title>
<style>
:root{ --bg:#000; --text:#fff; --accent:#16a34a; }
*{ box-sizing:border-box; }
html, body{ margin:0; height:100%; background:var(--bg); color:var(--text); overflow-x:hidden; overflow-y:auto; }

/* Full-bleed hero */
.hero-bleed{ width:100vw; position:relative; left:50%; right:50%; margin-left:-50vw; margin-right:-50vw; background:#000; }
.hero-bleed video{ display:block; width:100%; height:auto; max-height:86vh; object-fit:cover; }
.unmute-btn{
  position:absolute; left:50%; bottom:24px; transform:translateX(-50%);
  background:#1d4ed8; color:#fff; border:none; border-radius:999px;
  padding:22px 52px; font-size:34px; cursor:pointer;
  box-shadow:0 10px 26px rgba(0,0,0,.55); z-index:9999; pointer-events:auto;
}
.unmute-btn:focus{ outline:3px solid rgba(255,255,255,.75); outline-offset:2px; }

/* Page container */
#pageWrap{ width:100%; max-width:1600px; margin:0 auto; padding:0 16px 56px; }

/* Split layout 50/50 with sticky right */
#splitLayout{ display:none; gap:28px; align-items:flex-start; margin-top:28px; }
.left-col{ flex:0 0 calc(50% - 14px); min-width:0; }
.right-col{ flex:0 0 calc(50% - 14px); position:sticky; top:16px; align-self:flex-start; }
@media (max-width:1100px){
  #splitLayout{ flex-direction:column; }
  .right-col{ position:static; width:100%; max-width:100%; }
}

/* Left media stack */
.media-block{ width:100%; margin:0 0 26px 0; }
.media-block video,.media-block img{ width:100%; height:auto; display:block; border-radius:8px; margin:0; }

/* Map narrower to show portrait shape */
#mapSection{ display:none; }
#mapSection.narrow{ max-width:520px; }

/* Intake styles */
.form-container{ overflow-x:hidden; }
.form-container h2{ margin:0 0 10px 0; font-size:24px; }
.form-row{ margin:10px 0; }
label{ display:block; margin:0 0 6px 2px; font-size:13px; color:rgba(255,255,255,.75); }
.text-input, .form-container input[type="text"], .form-container input[type="email"], .form-container input[type="tel"], .form-container textarea{
  width:100%; padding:10px 12px; border:1px solid rgba(255,255,255,.25); border-radius:4px; background:#fff; color:#111; font-size:14px;
}
.form-container textarea{ min-height:110px; resize:vertical; }
.form-container input[type="file"].file-input{
  width:100%; padding:10px 12px; border:1px solid rgba(255,255,255,.25); border-radius:4px; background:#fff; color:#111;
}
.form-container input[type="file"].file-input::-webkit-file-upload-button,
.form-container input[type="file"].file-input::file-selector-button{
  background:#e9ecef; border:1px solid rgba(0,0,0,.2); border-radius:4px; padding:8px 12px; margin-right:10px; cursor:pointer;
}
.submit-btn{ display:inline-block; width:100%; padding:12px 16px; background:var(--accent); color:#fff; border:none; border-radius:4px; font-weight:600; cursor:pointer; }
.small-note{ margin-top:8px; color:rgba(255,255,255,.7); font-size:12px; }
/* v32: make only Video 3 smaller & centered */
#video3Section{
  width:50%;
  min-width:420px;
  margin-left:auto;
  margin-right:auto;
}
/* keep map portrait-narrow */
#mapSection.narrow{ max-width:520px; }
@media (max-width:1100px){
  #video3Section{ width:100%; min-width:0; }
}
</style>
</head>
<body>

<!-- HERO -->
<section class="hero-bleed" id="hero">
  <video id="video1" playsinline muted autoplay controls>
    <source src="https://res.cloudinary.com/ds5kbupzc/video/upload/video1_fixed_kjltks.mp4" type="video/mp4">
  </video>
  <button id="unmute1" class="unmute-btn" type="button">Unmute</button>
</section>

<div id="pageWrap">
  <div id="splitLayout" class="flex" style="display:none;">
    <!-- LEFT column -->
    <div class="left-col">
      <section id="video2Section" class="media-block">
        <video id="video2" playsinline muted controls>
          <source src="https://res.cloudinary.com/ds5kbupzc/video/upload/v1754981683/video2C_fixed_gcuiql.mp4" type="video/mp4">
        </video>
      </section>

      <section id="mapSection" class="media-block narrow" style="display:none;">
        <img id="nmMap" src="assets/Portrait MAP New Mexico Counties.jpg" alt="New Mexico counties map">
      </section>

      <section id="video3Section" class="media-block" style="display:none;">
        <video id="video3" playsinline muted controls>
          <source src="https://res.cloudinary.com/ds5kbupzc/video/upload/v1754951208/Order_Quote_Process_Elisabetta_US_English_Cropped_s2lz8l.mp4" type="video/mp4">
        </video>
      </section>
    </div>

    <!-- RIGHT column -->
    <aside class="right-col">
      <div class="form-container">
        <h2>Broker Price Opinion (BPO) Intake</h2>
        <form action="https://formspree.io/f/manbdzgp" method="POST" enctype="multipart/form-data">
          <div class="form-row">
            <label>Subject Property Address</label>
            <div style="display:flex; gap:8px;">
              <input class="text-input" type="text" name="Street Address" placeholder="Street Address" required>
              <input class="text-input" type="text" name="City/Town" placeholder="City/Town" required style="max-width:200px">
              <input class="text-input" type="text" name="NM Zip" placeholder="NM Zip" required style="max-width:120px">
            </div>
          </div>

          <div class="form-row"><input class="text-input" type="text" name="County Assessor Owner" placeholder="County Assessorâ€™s Owner Name"></div>
          <div class="form-row"><input class="text-input" type="text" name="Ordering Company or Person" placeholder="Company or Person Ordering Name"></div>
          <div class="form-row"><input class="text-input" type="email" name="Contact Email" placeholder="Your Contact Email" required></div>
          <div class="form-row"><input class="text-input" type="tel" name="Contact Phone" placeholder="Your Contact Phone" required></div>
          <div class="form-row"><textarea class="text-input" name="Additional Details" placeholder="Additional Details"></textarea></div>
          <div class="form-row"><input class="text-input" type="text" name="Assessor Identifying Owner#" placeholder="Assessor Identifying Owner#"></div>

          <div class="form-row">
            <label>Attach file(s) (.jpg or .pdf)</label>
            <input type="file" name="attachments" accept=".jpg,.jpeg,application/pdf" multiple class="text-input file-input">
          </div>

          <button type="submit" class="submit-btn">Submit BPO Request</button>
          <div class="small-note">Optional: BPOsNewMexico.com direct phone: 505-453-0444</div>
        </form>
      </div>
    </aside>
  </div>
</div>




<script>
/* v33: stronger unmute + guaranteed scroll fallbacks */
document.addEventListener('DOMContentLoaded', function(){
  const v1 = document.getElementById('video1');
  const unmute1 = document.getElementById('unmute1');
  const split = document.getElementById('splitLayout');
  const v2 = document.getElementById('video2');
  const v2Sec = document.getElementById('video2Section');
  const mapSec = document.getElementById('mapSection');
  const v3 = document.getElementById('video3');
  const v3Sec = document.getElementById('video3Section');

  // Ensure button is clickable above controls
  if (unmute1){ unmute1.style.zIndex = '99999'; unmute1.style.pointerEvents = 'auto'; }

  // Helper: smooth scroll with reliable fallback
  function smartScrollTo(el, durationMs){
    return new Promise(async (resolve)=>{
      if (!el){ resolve(); return; }
      const startY = window.scrollY || window.pageYOffset;
      let moved = false;
      try {
        el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        await new Promise(r => setTimeout(r, 150));
        moved = Math.abs((window.scrollY||window.pageYOffset) - startY) > 2;
      } catch(_) { moved = false; }
      if (moved){ await new Promise(r => setTimeout(r, durationMs||4800)); resolve(); return; }
      const rect = el.getBoundingClientRect();
      const targetY = Math.max(0, (window.scrollY||window.pageYOffset) + rect.top - 8);
      const startT = performance.now();
      const dur = Math.max(1500, durationMs || 4800);
      function ease(t){ return t<.5 ? 2*t*t : -1+(4-2*t)*t; }
      function step(now){
        const p = Math.min(1, (now - startT)/dur);
        const y = startY + (targetY - startY) * ease(p);
        window.scrollTo(0, y);
        if (p < 1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
      setTimeout(resolve, dur+60);
    });
  }

  // Strong unmute: blue button OR clicking the video restarts v1 and enables audio later
  async function doUnmuteRestart(){
    try { v1.currentTime = 0; v1.muted = false; v1.volume = 1.0; await v1.play(); } catch(_){}
    window.userInteracted = true;
    if (unmute1) unmute1.style.display = 'none';
  }
  if (unmute1) unmute1.addEventListener('click', doUnmuteRestart);
  if (v1) v1.addEventListener('click', () => { if (v1.muted) doUnmuteRestart(); }, { once:false });

  // Flow to V2
  let toV2Started = false;
  async function toV2(){
    if (toV2Started) return; toV2Started = true;
    if (split && split.style.display !== 'flex') split.style.display = 'flex';
    await new Promise(r => requestAnimationFrame(()=>r()));
    await smartScrollTo(v2Sec, 5000);
    setTimeout(async () => {
      try { v2.muted = window.userInteracted ? false : true; await v2.play(); } catch(_){}
    }, 5000);
  }

  if (v1){
    v1.addEventListener('ended', toV2, { once:true });
    v1.addEventListener('timeupdate', () => {
      if (!toV2Started && v1.duration && v1.currentTime / v1.duration > 0.985) { toV2(); }
    });
    // Fallback: after metadata, set a max timeout to move on even if 'ended' fails
    v1.addEventListener('loadedmetadata', () => {
      const ms = Math.max(8000, Math.floor((v1.duration||20)*1000) + 1500);
      setTimeout(() => { if (!toV2Started) toV2(); }, ms);
    });
    // Absolute fallback after 45s
    setTimeout(() => { if (!toV2Started) toV2(); }, 45000);
  }

  // V2 end -> Map -> V3 with delays
  if (v2 && mapSec && v3 && v3Sec){
    v2.addEventListener('ended', async () => {
      mapSec.style.display = 'block';
      await new Promise(r => requestAnimationFrame(()=>r()));
      await smartScrollTo(mapSec, 5000);
      setTimeout(async () => {
        v3Sec.style.display = 'block';
        await new Promise(r => requestAnimationFrame(()=>r()));
        await smartScrollTo(v3Sec, 5000);
        setTimeout(async () => {
          try { v3.muted = window.userInteracted ? false : true; await v3.play(); } catch(_){}
        }, 5000);
      }, 6000);
    }, { once:true });
  }

  // Cleanup legacy overlays
  document.querySelectorAll('.map-bubble, #mapBubbleContainer').forEach(n => n.remove());
});
</script>

</body>
</html>
